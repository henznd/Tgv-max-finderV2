<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Frontend Integration</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        .destination { background: white; border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 8px; }
        .train { background: #f9f9f9; margin: 5px 0; padding: 10px; border-radius: 5px; }
        .header { background: linear-gradient(to right, #3b82f6, #8b5cf6); color: white; padding: 15px; border-radius: 8px 8px 0 0; }
        .loading { text-align: center; padding: 20px; }
        .spinner { border: 2px solid #f3f3f3; border-top: 2px solid #3498db; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <h1>Test Frontend Integration - TGV Max</h1>
    
    <div>
        <label>Date: <input type="date" id="date" value="2025-07-02"></label>
        <label>Origine: <input type="text" id="origin" value="PARIS"></label>
        <button onclick="testFrontendIntegration()">Tester l'intégration frontend</button>
    </div>
    
    <div id="result"></div>

    <script>
        async function testFrontendIntegration() {
            const resultDiv = document.getElementById('result');
            const date = document.getElementById('date').value;
            const origin = document.getElementById('origin').value;
            
            // Simuler le comportement du frontend
            resultDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Recherche en cours...</p>
                </div>
            `;
            
            try {
                // URL exactement comme dans le frontend
                const url = `http://localhost:8000/api/trains/single?date=${date}&origin=${origin}`;
                console.log('URL de recherche:', url);
                
                const response = await fetch(url);
                console.log('Réponse reçue:', response.status, response.statusText);
                
                if (!response.ok) {
                    throw new Error('La recherche a échoué. Veuillez réessayer.');
                }
                
                const data = await response.json();
                console.log('Données reçues:', data);
                console.log('Type de données:', typeof data);
                console.log('Longueur des données:', Array.isArray(data) ? data.length : 'Non un tableau');
                
                // Afficher les résultats comme dans le frontend
                displayResults(data);
                
            } catch (error) {
                console.error('Erreur lors de la recherche:', error);
                resultDiv.innerHTML = `
                    <div class="result error">
                        <h3>❌ Erreur d'intégration</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        function displayResults(data) {
            const resultDiv = document.getElementById('result');
            
            if (!Array.isArray(data) || data.length === 0) {
                resultDiv.innerHTML = `
                    <div class="result">
                        <h3>Aucun résultat trouvé</h3>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div class="result success">
                    <h3>✅ Intégration réussie !</h3>
                    <p>Nombre de destinations trouvées: ${data.length}</p>
                </div>
            `;
            
            // Afficher les destinations groupées comme dans le frontend
            data.slice(0, 3).forEach((destination, index) => {
                html += `
                    <div class="destination">
                        <div class="header">
                            <h3>${destination.destination}</h3>
                            <p>${destination.count} trajet${destination.count > 1 ? 's' : ''} disponible${destination.count > 1 ? 's' : ''}</p>
                        </div>
                        <div style="padding: 15px;">
                            ${destination.trains.slice(0, 3).map(train => `
                                <div class="train">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <strong>${train.origine}</strong>
                                            <br><small>Départ</small>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="width: 50px; height: 2px; background: #ddd; position: relative;">
                                                <div style="position: absolute; top: -3px; left: 0; width: 6px; height: 6px; background: #3b82f6; border-radius: 50%;"></div>
                                                <div style="position: absolute; top: -3px; right: 0; width: 6px; height: 6px; background: #3b82f6; border-radius: 50%;"></div>
                                            </div>
                                            <small style="color: #666;">${train.duree}</small>
                                        </div>
                                        <div style="text-align: right;">
                                            <strong>${train.destination}</strong>
                                            <br><small>Arrivée</small>
                                        </div>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee;">
                                        <div style="text-align: center;">
                                            <div style="font-size: 18px; font-weight: bold; color: #3b82f6;">${train.heure_depart}</div>
                                            <small style="color: #666;">Départ</small>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="font-size: 18px; font-weight: bold; color: #10b981;">${train.heure_arrivee}</div>
                                            <small style="color: #666;">Arrivée</small>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                            ${destination.trains.length > 3 ? `<p style="text-align: center; color: #666;">+${destination.trains.length - 3} autres trains</p>` : ''}
                        </div>
                    </div>
                `;
            });
            
            resultDiv.innerHTML = html;
        }
    </script>
</body>
</html> 